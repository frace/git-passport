# -*- coding: utf-8 -*-


# ..................................................................... Imports
import sys

from . import util


# ............................................................ Dialog functions
def get_input(pool):
    """ Prompt a user to select a number from a list of numbers representing
        available Git IDs. Optionally the user can choose `q` to quit the
        selection process.

        Args:
            pool (list): A list of numbers representing available Git IDs

        Returns:
            None (NoneType): If the user quits the selection dialog
            selection (int): A number representing a Git ID chosen by a user
    """
    while True:
        # Redirect sys.stdin to an open filehandle from which input()
        # is able to read
        sys.stdin = open("/dev/tty")
        selection = input("» Select an [ID] or enter «(q)uit» to exit: ")

        try:
            selection = int(selection)

            if selection in pool:
                return selection

        except ValueError:
            if selection == "q" or selection == "quit":
                return None
            continue

        # Reset sys.stdin to its default value, even if we return early
        # when an exception occurs
        finally:
            sys.stdin = sys.__stdin__


def print_choice(choice):
    """ Before showing the actual prompt by calling `get_user_input()` print a
        list of available Git IDs containing properties ID, «scope», name,
        email and service.

        Args:
            choice (dict): Contains a list of preselected Git ID candidates

        Returns:
            True (bool): On success
    """
    for key, value in choice.items():
        if value.get("flag") == "global":
            msg = """
                ~:Global ID: {}
                    . User:   {}
                    . E-Mail: {}{}
            """.format(
                key,
                value["name"],
                value["email"],
                """
                    . no_remote: true""" if value["no_remote"] else ''
            )

            print(util.dedented(msg, "lstrip"))
        elif value.get("service"):
            msg = """
                ~Passport ID: {}
                    . User:    {}
                    . E-Mail:  {}
                    . Service: {}{}
            """.format(
                key,
                value["name"],
                value["email"],
                value["service"],
                """
                    . no_remote: true""" if value["no_remote"] else ''
            )

            print(util.dedented(msg, "lstrip"))
        else:
            msg = """
                ~:Passport ID: {}
                    . User:   {}
                    . E-Mail: {}{}
            """.format(
                key,
                value["name"],
                value["email"],
                """
                    . no_remote: true""" if value["no_remote"] else ''
            )

            print(util.dedented(msg, "lstrip"))

    return True
